<project name="build-tools" default="buildToolsJar">

    <path id="sourcepath.buildTools">
        <dirset dir="${basedir}/build-tools">
            <include name="core/src"/>
            <include name="ant/src"/>
            <include name="maven/src"/>
            <include name="gradle/src"/>
        </dirset>
    </path>

    <path id="classpath.buildTools">
        <path refid="classpath.kotlin"/>
        <fileset dir="${idea.sdk}/ant/lib" includes="*.jar"/>
    </path>

    <path id="dist.jars">
        <fileset dir="${idea.sdk}"    includes="*.jar"/>
        <fileset dir="${basedir}/lib" includes="*.jar"/>
        <fileset dir="${output}"      includes="*.jar"/>
    </path>

    <target name="buildToolsJar" depends="compile">
        <mkdir dir    ="${output}/classes/buildTools"/>
        <javac destdir="${output}/classes/buildTools" debug="true" debuglevel="lines,vars,source">
            <src       refid="sourcepath.buildTools"/>
            <classpath refid="classpath.buildTools"/>
        </javac>
        <jar destfile="${output}/kotlin-build-tools.jar">
            <fileset dir="${output}/classes/buildTools"/>
            <fileset dir="${basedir}/build-tools/ant/src" includes="**/*.xml"/>
        </jar>
    </target>

    <target name="buildToolsTest" depends="jarRT, jar, buildToolsJar">
        <taskdef resource     = "org/jetbrains/jet/buildtools/ant/tasks.xml"
                 classpathref = "dist.jars"/>

        <kotlinc file         = "${basedir}/build-tools/test/Hello.kt"
                 destdir      = "${output}/build-tools-test"/>
        <java    classpathref = "dist.jars"
                 classname    = "namespace">
            <classpath path   = "${output}/build-tools-test"/>
        </java>

        <kotlinc srcdir       = "${basedir}/build-tools/test"
                 destdir      = "${output}/build-tools-test"/>
        <java    classpathref = "dist.jars"
                 classname    = "namespace">
            <classpath path   = "${output}/build-tools-test"/>
        </java>
    </target>
</project>
